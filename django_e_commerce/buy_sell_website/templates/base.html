<!-- base.html -->
{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Ana Sayfa{% endblock %}</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
  <!-- Font Awesome CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">

  <link rel="stylesheet" href="{% static 'css/style.css' %}" />

</head>

<body>
  <!-- Navbar -->
  <nav class="navbar border-bottom border-body position-sticky" style="background-color: #40465c; padding: 20px 0; top: 0; z-index: 999;">
    <div class="container-fluid">
      <a class="navbar-brand">
        <img src="{% static 'images/logo.png' %}" alt="logo" width="300" height="50" class="object-fit-contain" />
      </a>
      <!-- search icon inside a search box with svg -->
      <form class="d-flex">
        <input class="form-control me-2" type="search" placeholder="Ara" aria-label="Search" />
        <button class="btn btn-outline-success search-btn" type="submit" style="background-color: #fff;">
          <i class="fas fa-search"></i>
        </button>
      </form>
    </div>
  </nav>

  <!-- İçerik alanı -->
  <div class="container mt-5">
    <div class="d-lg-flex gap-4">
      <!-- category sidebar -->
      <div class="col-lg-3 category-sidebar">
        <!-- Sidebar content -->
        <ul id="category-list">
          <!-- Categories and subcategories will be populated here -->
        </ul>
      </div>

      <!-- Main content area -->
      {% block content %}
      <div class="col-md-9">
        <!-- Your main content goes here -->
      </div>
      {% endblock %}
    </div>
  </div>

  <!-- Bootstrap JS ve Popper.js -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
    integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
    crossorigin="anonymous"></script>

  <!-- Update the script tag to populate categories and subcategories with Font Awesome styling -->
  <script>
    // Define a state object to hold categories and subcategories
    const state = {};

    // Fetch categories and update the state
    fetch('/api/categories/')
      .then(response => response.json())
      .then(categories => {
        // Initialize the state object with empty arrays for each category
        categories.forEach(category => {
          state[category.categoryid] = {
            categoryname: category.categoryname,
            subcategories: [],
          };
        });

        // Fetch subcategories and update the state
        fetch('/api/subcategories/')
          .then(response => response.json())
          .then(subcategories => {
            // Group subcategories by category ID in the state object
            subcategories.forEach(subcategory => {
              const categoryId = subcategory.categoryid;

              if (state[categoryId]) {
                state[categoryId].subcategories.push({
                  subcategoryid: subcategory.subcategoryid,
                  subcategoryname: subcategory.subcategoryname,
                });
              }
            });

            // Now, the state object contains categories with their related subcategories
            console.log(state);

            // Access the DOM elements to populate categories and subcategories
            const categoryList = document.getElementById('category-list');
            for (const categoryId in state) {
              const category = state[categoryId];
              const categoryItem = document.createElement('li');
              categoryItem.classList.add('list-group-item');
              const categoryNameLink = document.createElement('a');
              categoryNameLink.href = '#';
              categoryNameLink.classList.add('d-flex', 'align-items-center', 'fw-bold');

              // Font Awesome Icon
              const icon = document.createElement('i');
              icon.classList.add('fas', 'fa-gear', 'me-2', 'fa-solid');
              categoryNameLink.appendChild(icon);

              // Category Name
              categoryNameLink.textContent = category.categoryname;
              categoryItem.appendChild(categoryNameLink);

              if (category.subcategories.length > 0) {
                const subcategoryList = document.createElement('ul');
                subcategoryList.classList.add('list-group');
                category.subcategories.forEach(subcategory => {
                  const subcategoryItem = document.createElement('li');
                  subcategoryItem.classList.add('list-group-item');
                  const subcategoryNameLink = document.createElement('a');
                  subcategoryNameLink.href = '#';
                  subcategoryNameLink.textContent = subcategory.subcategoryname;
                  subcategoryItem.appendChild(subcategoryNameLink);
                  subcategoryList.appendChild(subcategoryItem);
                });
                categoryItem.appendChild(subcategoryList);
              }

              categoryList.appendChild(categoryItem);
            }
          })
          .catch(error => console.error('Error fetching subcategories:', error));
      })
      .catch(error => console.error('Error fetching categories:', error));
  </script>

</body>

</html>
